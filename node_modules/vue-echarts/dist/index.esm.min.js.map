{"version":3,"file":"index.esm.min.js","sources":["../src/composables/api.ts","../src/composables/autoresize.ts","../src/composables/loading.ts","../node_modules/rollup-plugin-styles/dist/runtime/inject-css.js","../src/utils.ts","../src/ECharts.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { Ref } from \"vue-demi\";\nimport { EChartsType, Option } from \"../types\";\n\nconst METHOD_NAMES = [\n  \"getWidth\",\n  \"getHeight\",\n  \"getDom\",\n  \"getOption\",\n  \"resize\",\n  \"dispatchAction\",\n  \"convertToPixel\",\n  \"convertFromPixel\",\n  \"containPixel\",\n  \"getDataURL\",\n  \"getConnectedDataURL\",\n  \"appendData\",\n  \"clear\",\n  \"isDisposed\",\n  \"dispose\"\n] as const;\ntype MethodName = typeof METHOD_NAMES[number];\n\ntype PublicMethods = Pick<EChartsType, MethodName>;\n\nexport function usePublicAPI(\n  chart: Ref<EChartsType | undefined>,\n  init: (option?: Option) => void\n): PublicMethods {\n  function makePublicMethod<T extends MethodName>(\n    name: T\n  ): (...args: Parameters<EChartsType[T]>) => ReturnType<EChartsType[T]> {\n    return (...args) => {\n      if (!chart.value) {\n        init();\n      }\n\n      if (!chart.value) {\n        throw new Error(\"ECharts is not initialized yet.\");\n      }\n      return (chart.value[name] as any).apply(chart.value, args);\n    };\n  }\n\n  function makePublicMethods(): PublicMethods {\n    const methods = Object.create(null);\n    METHOD_NAMES.forEach(name => {\n      methods[name] = makePublicMethod(name);\n    });\n\n    return methods as PublicMethods;\n  }\n\n  return makePublicMethods();\n}\n","import { Ref, watch } from \"vue-demi\";\nimport { throttle } from \"echarts/core\";\nimport { addListener, removeListener, ResizeCallback } from \"resize-detector\";\nimport { EChartsType } from \"../types\";\n\nexport function useAutoresize(\n  chart: Ref<EChartsType | undefined>,\n  autoresize: Ref<boolean>,\n  root: Ref<HTMLElement | undefined>\n): void {\n  let resizeListener: ResizeCallback | null = null;\n\n  watch([root, chart, autoresize], ([root, chart, autoresize], _, cleanup) => {\n    if (root && chart && autoresize) {\n      resizeListener = throttle(() => {\n        chart.resize();\n      }, 100);\n\n      addListener(root, resizeListener);\n    }\n\n    cleanup(() => {\n      if (resizeListener && root) {\n        removeListener(root, resizeListener);\n      }\n    });\n  });\n}\n\nexport const autoresizeProps = {\n  autoresize: Boolean\n};\n","import { inject, unref, computed, Ref, watchEffect } from \"vue-demi\";\nimport { EChartsType } from \"../types\";\n\nexport const LOADING_OPTIONS_KEY = \"ecLoadingOptions\";\n\ntype UnknownRecord = Record<string, unknown>;\n\nexport function useLoading(\n  chart: Ref<EChartsType | undefined>,\n  loading: Ref<boolean>,\n  loadingOptions: Ref<UnknownRecord | undefined>\n): void {\n  const defaultLoadingOptions = inject(LOADING_OPTIONS_KEY, {}) as\n    | UnknownRecord\n    | Ref<UnknownRecord>;\n  const realLoadingOptions = computed(() => ({\n    ...unref(defaultLoadingOptions),\n    ...loadingOptions?.value\n  }));\n\n  watchEffect(() => {\n    const instance = chart.value;\n    if (!instance) {\n      return;\n    }\n\n    if (loading.value) {\n      instance.showLoading(realLoadingOptions.value);\n    } else {\n      instance.hideLoading();\n    }\n  });\n}\n\nexport const loadingProps = {\n  loading: Boolean,\n  loadingOptions: Object\n};\n","var e=[],t=[];function n(n,r){if(n&&\"undefined\"!=typeof document){var a,s=!0===r.prepend?\"prepend\":\"append\",d=!0===r.singleTag,i=\"string\"==typeof r.container?document.querySelector(r.container):document.getElementsByTagName(\"head\")[0];if(d){var u=e.indexOf(i);-1===u&&(u=e.push(i)-1,t[u]={}),a=t[u]&&t[u][s]?t[u][s]:t[u][s]=c()}else a=c();65279===n.charCodeAt(0)&&(n=n.substring(1)),a.styleSheet?a.styleSheet.cssText+=n:a.appendChild(document.createTextNode(n))}function c(){var e=document.createElement(\"style\");if(e.setAttribute(\"type\",\"text/css\"),r.attributes)for(var t=Object.keys(r.attributes),n=0;n<t.length;n++)e.setAttribute(t[n],r.attributes[t[n]]);var a=\"prepend\"===s?\"afterbegin\":\"beforeend\";return i.insertAdjacentElement(a,e),e}}export default n;\n","type Attrs = {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  [key: string]: any;\n};\n\n// Copied from\n// https://github.com/vuejs/vue-next/blob/5a7a1b8293822219283d6e267496bec02234b0bc/packages/shared/src/index.ts#L40-L41\nconst onRE = /^on[^a-z]/;\nexport const isOn = (key: string): boolean => onRE.test(key);\n\nexport function omitOn(attrs: Attrs): Attrs {\n  const result: Attrs = {};\n  for (const key in attrs) {\n    if (!isOn(key)) {\n      result[key] = attrs[key];\n    }\n  }\n\n  return result;\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport {\n  defineComponent,\n  unref,\n  shallowRef,\n  toRefs,\n  watch,\n  computed,\n  inject,\n  onMounted,\n  onUnmounted,\n  h,\n  nextTick,\n  PropType,\n  watchEffect,\n  Vue2\n} from \"vue-demi\";\nimport { init as initChart } from \"echarts/core\";\nimport {\n  EChartsType,\n  Option,\n  Theme,\n  ThemeInjection,\n  InitOptions,\n  InitOptionsInjection,\n  UpdateOptions,\n  UpdateOptionsInjection\n} from \"./types\";\nimport {\n  usePublicAPI,\n  useAutoresize,\n  autoresizeProps,\n  useLoading,\n  loadingProps\n} from \"./composables\";\nimport \"./style.css\";\nimport { omitOn } from \"./utils\";\n\nconst TAG_NAME = \"x-vue-echarts\";\n\nif (Vue2) {\n  Vue2.config.ignoredElements.push(TAG_NAME);\n}\n\nexport const THEME_KEY = \"ecTheme\";\nexport const INIT_OPTIONS_KEY = \"ecInitOptions\";\nexport const UPDATE_OPTIONS_KEY = \"ecUpdateOptions\";\nexport { LOADING_OPTIONS_KEY } from \"./composables\";\n\nexport default defineComponent({\n  name: \"echarts\",\n  props: {\n    option: Object as PropType<Option>,\n    theme: {\n      type: [Object, String] as PropType<Theme>\n    },\n    initOptions: Object as PropType<InitOptions>,\n    updateOptions: Object as PropType<UpdateOptions>,\n    group: String,\n    manualUpdate: Boolean,\n    ...autoresizeProps,\n    ...loadingProps\n  },\n  inheritAttrs: false,\n  // @ts-expect-error listeners for Vue 2 compatibility\n  setup(props, { attrs, listeners }) {\n    const root = shallowRef<HTMLElement>();\n    const chart = shallowRef<EChartsType>();\n    const manualOption = shallowRef<Option>();\n    const defaultTheme = inject(THEME_KEY, null) as ThemeInjection;\n    const defaultInitOptions = inject(\n      INIT_OPTIONS_KEY,\n      null\n    ) as InitOptionsInjection;\n    const defaultUpdateOptions = inject(\n      UPDATE_OPTIONS_KEY,\n      null\n    ) as UpdateOptionsInjection;\n\n    const { autoresize, manualUpdate, loading, loadingOptions } = toRefs(props);\n\n    const realOption = computed(\n      () => manualOption.value || props.option || Object.create(null)\n    );\n    const realTheme = computed(() => props.theme || unref(defaultTheme) || {});\n    const realInitOptions = computed(\n      () => props.initOptions || unref(defaultInitOptions) || {}\n    );\n    const realUpdateOptions = computed(\n      () => props.updateOptions || unref(defaultUpdateOptions) || {}\n    );\n    const nonEventAttrs = computed(() => omitOn(attrs));\n\n    function init(option?: Option) {\n      if (chart.value || !root.value) {\n        return;\n      }\n\n      const instance = (chart.value = initChart(\n        root.value,\n        realTheme.value,\n        realInitOptions.value\n      ));\n\n      if (props.group) {\n        instance.group = props.group;\n      }\n\n      let realListeners = listeners;\n      if (!realListeners) {\n        realListeners = {};\n\n        Object.keys(attrs)\n          .filter(key => key.indexOf(\"on\") === 0 && key.length > 2)\n          .forEach(key => {\n            // onClick    -> c + lick\n            // onZr:click -> z + r:click\n            const event = key.charAt(2).toLowerCase() + key.slice(3);\n            realListeners[event] = attrs[key];\n          });\n      }\n\n      Object.keys(realListeners).forEach(key => {\n        const handler = realListeners[key] as any;\n\n        if (!handler) {\n          return;\n        }\n\n        if (key.indexOf(\"zr:\") === 0) {\n          instance.getZr().on(key.slice(3).toLowerCase(), handler);\n        } else {\n          instance.on(key.toLowerCase(), handler);\n        }\n      });\n\n      function resize() {\n        if (instance && !instance.isDisposed()) {\n          // temporarily suppress errors caused by https://github.com/apache/echarts/issues/14846\n          try {\n            instance.resize();\n          } catch (e) {\n            if (e.message === \"Cannot read property 'get' of undefined\") {\n              return;\n            }\n\n            throw e;\n          }\n        }\n      }\n\n      function commit() {\n        instance.setOption(option || realOption.value, realUpdateOptions.value);\n      }\n\n      if (autoresize.value) {\n        // Try to make chart fit to container in case container size\n        // is changed synchronously or in already queued microtasks\n        nextTick(() => {\n          resize();\n          commit();\n        });\n      } else {\n        commit();\n      }\n    }\n\n    function setOption(option: Option, updateOptions?: UpdateOptions) {\n      if (props.manualUpdate) {\n        manualOption.value = option;\n      }\n\n      if (!chart.value) {\n        init(option);\n      } else {\n        chart.value.setOption(option, updateOptions || {});\n      }\n    }\n\n    function cleanup() {\n      if (chart.value) {\n        chart.value.dispose();\n        chart.value = undefined;\n      }\n    }\n\n    let unwatchOption: (() => void) | null = null;\n    watch(\n      manualUpdate,\n      manualUpdate => {\n        if (typeof unwatchOption === \"function\") {\n          unwatchOption();\n          unwatchOption = null;\n        }\n\n        if (!manualUpdate) {\n          unwatchOption = watch(\n            () => props.option,\n            option => {\n              if (!option) {\n                return;\n              }\n              if (!chart.value) {\n                init();\n              } else {\n                chart.value.setOption(option, realUpdateOptions.value);\n              }\n            },\n            { deep: true }\n          );\n        }\n      },\n      {\n        immediate: true\n      }\n    );\n\n    watch(\n      [realTheme, realInitOptions],\n      () => {\n        cleanup();\n        init();\n      },\n      {\n        deep: true\n      }\n    );\n\n    watchEffect(() => {\n      if (props.group && chart.value) {\n        chart.value.group = props.group;\n      }\n    });\n\n    const publicApi = usePublicAPI(chart, init);\n\n    useLoading(chart, loading, loadingOptions);\n\n    useAutoresize(chart, autoresize, root);\n\n    onMounted(() => {\n      if (props.option) {\n        init();\n      }\n    });\n\n    onUnmounted(cleanup);\n\n    return {\n      chart,\n      root,\n      setOption,\n      nonEventAttrs,\n      ...publicApi\n    };\n  },\n  render() {\n    const attrs = { ...this.nonEventAttrs };\n    attrs.ref = \"root\";\n    attrs.class = attrs.class ? [\"echarts\"].concat(attrs.class) : \"echarts\";\n    return h(TAG_NAME, attrs);\n  }\n});\n"],"names":["METHOD_NAMES","usePublicAPI","chart","init","methods","Object","create","forEach","name","_i","args","value","Error","apply","makePublicMethod","autoresizeProps","autoresize","Boolean","LOADING_OPTIONS_KEY","loadingProps","loading","loadingOptions","e","t","n","r","document","a","s","prepend","d","singleTag","i","container","querySelector","getElementsByTagName","u","indexOf","push","c","charCodeAt","substring","styleSheet","cssText","appendChild","createTextNode","createElement","setAttribute","attributes","keys","length","insertAdjacentElement","onRE","isOn","key","test","Vue2","config","ignoredElements","THEME_KEY","INIT_OPTIONS_KEY","UPDATE_OPTIONS_KEY","defineComponent","props","option","theme","type","String","initOptions","updateOptions","group","manualUpdate","inheritAttrs","setup","_a","attrs","listeners","root","shallowRef","manualOption","defaultTheme","inject","defaultInitOptions","defaultUpdateOptions","_b","toRefs","realOption","computed","realTheme","unref","realInitOptions","realUpdateOptions","nonEventAttrs","result","omitOn","instance","initChart","realListeners","filter","event","charAt","toLowerCase","slice","handler","getZr","on","nextTick","isDisposed","resize","message","commit","setOption","cleanup","dispose","undefined","unwatchOption","watch","deep","immediate","watchEffect","publicApi","defaultLoadingOptions","realLoadingOptions","showLoading","hideLoading","useLoading","resizeListener","_","throttle","addListener","removeListener","useAutoresize","onMounted","onUnmounted","render","this","ref","class","concat","h"],"mappings":"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"}